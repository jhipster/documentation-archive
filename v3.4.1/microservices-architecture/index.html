<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="JHipster Team">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@java_hipster" />
    <meta name="twitter:title" content="Generate a full stack Java + JavaScript application in a few steps" />
    <meta name="twitter:description" content="JHipster is a fully Open Source, widely used application generator. It leverages cool technologies like Spring Boot, AngularJS and Yeoman to give you a high level of productivity and quality." />
    <meta name="twitter:image:src" content="http://jhipster.github.io/img/screenshot_1.png" />
    <meta name="twitter:url" content="http://jhipster.github.io/" />
    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#353d47">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#353d47">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-status-bar-style" content="#353d47">
    <title>Doing microservices with JHipster</title>

    <!-- Fonts -->
    <link href='https://fonts.googleapis.com/css?family=Roboto+Condensed:300,400' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Lato:300,400,700,900' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Pacifico" rel="stylesheet" type="text/css">

    <!-- CSS Libs -->
    <link rel="stylesheet" type="text/css" href="/documentation-archive/v3.4.1/lib/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/documentation-archive/v3.4.1/lib/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/documentation-archive/v3.4.1/lib/css/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/documentation-archive/v3.4.1/lib/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="/documentation-archive/v3.4.1/lib/css/dataTables.bootstrap.css">
    <!-- CSS App -->
    <link rel="stylesheet" type="text/css" href="/documentation-archive/v3.4.1/css/style.css">
    <link rel="stylesheet" type="text/css" href="/documentation-archive/v3.4.1/css/themes/flat-blue.css">
    
    <!-- Bootstrap Docs CSS subset to get icon -->
    <!--<link href="/css/bootstrap-docs.css" rel="stylesheet">-->

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Favicon with QHD -->
    <link rel="icon" type="image/png" href="/documentation-archive/v3.4.1/img/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/documentation-archive/v3.4.1/img/favicon-16x16.png" sizes="16x16" />
</head>

<body class="flat-blue">
    <div class="app-container expanded ">
        <div class="row content-container">
            <nav class="navbar navbar-inverse navbar-fixed-top navbar-top">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <button type="button" class="navbar-expand-toggle fa-rotate-90">
                            <i class="fa fa-bars icon"></i>
                        </button>
                        <ol class="breadcrumb navbar-breadcrumb">
                            <li class="active"></li>
                        </ol>
                        <button type="button" class="navbar-right-expand-toggle pull-right visible-xs">
                            <i class="fa fa-th icon"></i>
                        </button>
                    </div>
                    <ul class="nav navbar-nav navbar-right">
                        <button type="button" class="navbar-right-expand-toggle pull-right visible-xs light">
                            <i class="fa fa-times icon"></i>
                        </button>
                        
                        <li class="">
                            <a href="/documentation-archive/v3.4.1/v2-documentation/" class="dropdown-toggle navlink" target="_blank" role="button">v2.x Docs</a>
                        </li>
                        <li class="">
                            <a href="https://github.com/jhipster/generator-jhipster" class="dropdown-toggle navlink" target="_blank" role="button"><i class="fa fa-github fa-2x"></i></a>
                        </li>
                    </ul>

                </div>
            </nav>
            <div class="side-menu sidebar-inverse">
                <nav class="navbar navbar-default" role="navigation">
                    <div class="side-menu-container">
                        <div class="navbar-header">
                            <a class="navbar-brand" href="/">
                                <div class="icon"><img src="/documentation-archive/v3.4.1/img/logo-jhipster2x.png" height="50px"></div>
                                <div class="title brand">JHipster </div>
                            </a>
                            <button type="button" class="navbar-expand-toggle pull-right visible-xs">
                                <i class="fa fa-times icon"></i>
                            </button>
                        </div>
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="/">
                                    <span class="icon fa fa-home"></span><span class="title">Home</span>
                                </a>
                            </li>
                            <li >
                                <a href="/documentation-archive/v3.4.1/releases/">
                                    <span class="icon fa fa-file-text-o"></span><span class="title">Release notes</span>
                                </a>
                            </li>
                            <li class="panel panel-default dropdown">
                                <a data-toggle="collapse" href="#dropdown-1">
                                    <span class="icon fa fa-road"></span><span class="title">JHipster in a few minutes</span>
                                </a>
                                <!-- Dropdown level 1 -->
                                <div id="dropdown-1" class="panel-collapse collapse">
                                    <div class="panel-body">
                                        <ul class="nav navbar-nav">
                                            <li ><a href="/documentation-archive/v3.4.1/tech-stack/"><i class="fa fa-fw fa-stack-overflow"></i> Technology stack</a></li>
                                            <li ><a href="/presentation" target="_blank"><i class="fa fa-fw fa-desktop"></i> Official JHipster slides</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/screenshots/"><i class="fa fa-fw fa-picture-o"></i> JHipster in 5 screenshots</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/video-tutorial/"><i class="fa fa-fw fa-film"></i> Video tutorial (20 minutes)</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </li>
                            <li class="panel panel-default dropdown">
                                <a data-toggle="collapse" href="#dropdown-2">
                                    <span class="icon fa fa-fw fa-wrench"></span><span class="title">Setting up your environment</span>
                                </a>
                                <!-- Dropdown level 1 -->
                                <div id="dropdown-2" class="panel-collapse collapse">
                                    <div class="panel-body">
                                        <ul class="nav navbar-nav">
                                            <li ><a href="/documentation-archive/v3.4.1/installation/"><i class="fa fa-fw fa-cloud-download"></i> Installing JHipster</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/configuring-ide/"><i class="fa fa-fw fa-keyboard-o"></i> Configuring Eclipse/IntelliJ</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/docker-compose/"><i class="fa fa-fw fa-music"></i> Docker Compose</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </li>
                            <li class="panel panel-default dropdown">
                                <a data-toggle="collapse" href="#dropdown-3"><span class="icon fa fa-fw fa-list-ol"></span><span class="title">Core JHipster tasks</span></a>
                                <div id="dropdown-3" class="panel-collapse collapse">
                                    <div class="panel-body">
                                        <ul class="nav navbar-nav">
                                            <li class="active" ><a href="/documentation-archive/v3.4.1/microservices-architecture/"><i class="fa fa-fw  fa-sitemap"></i> Doing microservices</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/creating-an-app/"><i class="fa fa-fw fa-rocket"></i> Creating an application</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/creating-an-entity/"><i class="fa fa-fw fa-bolt"></i> Creating an entity</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/creating-a-service/"><i class="fa fa-fw fa-bolt"></i> Creating a service</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/using-dtos/"><i class="fa fa-fw fa-briefcase"></i> Creating DTOs</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/managing-relationships/"><i class="fa fa-fw fa-sitemap"></i> Managing relationships</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/installing-new-languages/"><i class="fa fa-fw fa-flag"></i> Internationalization</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/upgrading-an-application/"><i class="fa fa-fw fa-refresh"></i> Upgrading an application</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </li>
                            <li class="panel panel-default dropdown">
                                <a data-toggle="collapse" href="#dropdown-4"><span class="icon fa fa-fw fa-puzzle-piece"></span><span class="title">Options</span></a>
                                <div id="dropdown-4" class="panel-collapse collapse">
                                    <div class="panel-body">
                                        <ul class="nav navbar-nav">
                                            <li ><a href="/documentation-archive/v3.4.1/security/"><i class="fa fa-fw fa-lock"></i> Securing your app</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/using-elasticsearch/"><i class="fa fa-fw fa-search"></i> Using Elasticsearch</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/using-websockets/"><i class="fa fa-fw fa-envelope"></i> Using Websockets</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/using-oracle/"><i class="fa fa-fw fa-archive"></i> Using Oracle</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/using-mongodb/"><i class="fa fa-fw fa-leaf"></i> Using MongoDB</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/using-cassandra/"><i class="fa fa-fw fa-eye"></i> Using Cassandra</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </li>
                            <li class="panel panel-default dropdown">
                                <a data-toggle="collapse" href="#dropdown-5"><span class="icon fa fa-fw fa-code"></span><span class="title">Development</span></a>
                                <div id="dropdown-5" class="panel-collapse collapse">
                                    <div class="panel-body">
                                        <ul class="nav navbar-nav">
                                            <li ><a href="/documentation-archive/v3.4.1/development/"><i class="fa fa-fw fa-code"></i> Using in development</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/profiles/"><i class="fa fa-fw fa-group"></i> Managing profiles</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/using-angularjs/"><i class="fa fa-fw fa-html5"></i> Using AngularJS</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/customizing-bootstrap/"><i class="fa fa-fw fa-css3"></i> Customizing Bootstrap</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </li>
                            <li class="panel panel-default dropdown">
                                <a data-toggle="collapse" href="#dropdown-6"><span class="icon fa fa-fw fa-umbrella"></span><span class="title">Test &amp; QA</span></a>
                                <div id="dropdown-6" class="panel-collapse collapse">
                                    <div class="panel-body">
                                        <ul class="nav navbar-nav">
                                            <li ><a href="/documentation-archive/v3.4.1/running-tests/"><i class="fa fa-fw fa-shield"></i> Running tests</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/code-quality/"><i class="fa fa-fw fa-diamond"></i> Code quality</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/setting-up-ci/"><i class="fa fa-fw fa-stethoscope"></i> Continuous Integration</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </li>
                            <li class="panel panel-default dropdown">
                                <a data-toggle="collapse" href="#dropdown-7"><span class="icon fa fa-fw fa-cloud"></span><span class="title">Production</span></a>
                                <div id="dropdown-7" class="panel-collapse collapse">
                                    <div class="panel-body">
                                        <ul class="nav navbar-nav">
                                            <li ><a href="/documentation-archive/v3.4.1/production/"><i class="fa fa-fw fa-play-circle"></i> Using in production</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/monitoring/"><i class="fa fa-fw fa-line-chart"></i> Monitoring</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/cloudfoundry/"><i class="fa fa-fw fa-cloud-upload"></i> Deploying to Cloud Foundry</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/heroku/"><i class="fa fa-fw fa-cloud-upload"></i> Deploying to Heroku</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/aws/"><i class="fa fa-fw fa-cloud-upload"></i> Deploying to AWS</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </li>
                            <li class="panel panel-default dropdown">
                                <a data-toggle="collapse" href="#dropdown-8"><span class="icon fa fa-fw fa-cubes"></span><span class="title">Modules</span></a>
                                <div id="dropdown-8" class="panel-collapse collapse" style="height: 0px;">
                                    <div class="panel-body">
                                        <ul class="nav navbar-nav">
                                            <li ><a href="/documentation-archive/v3.4.1/modules/marketplace/"><i class="fa fa-fw fa-shopping-cart"></i> Marketplace</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/modules/creating-a-module/"><i class="fa fa-fw fa-cube"></i> Creating a module</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </li>
                            <li class="panel panel-default dropdown">
                                <a data-toggle="collapse" href="#dropdown-9"><span class="icon fa fa-fw fa-wrench"></span><span class="title">Tools</span></a>
                                <div id="dropdown-9" class="panel-collapse collapse" style="height: 0px;">
                                    <div class="panel-body">
                                        <ul class="nav navbar-nav">
                                            <li ><a href="/documentation-archive/v3.4.1/jdl/"><i class="fa fa-fw fa-star"></i> JDL</a></li>
                                            <li><a href="/documentation-archive/v3.4.1/jdl-studio/"><i class="fa fa-fw fa-terminal"></i> JDL Studio</a></li>
                                            <li >
                                                <a href="/documentation-archive/v3.4.1/jhipster-uml/"><i class="fa fa-fw fa-magic"></i> JHipster-UML</a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </li>
                            <li ><a href="/documentation-archive/v3.4.1/tips/"><span class="icon fa fa-fw fa-cogs"></span><span class="title">Tips'n tricks</span></a></li>
                            <li class="panel panel-default dropdown">
                                <a data-toggle="collapse" href="#dropdown-10"><span class="icon fa fa-fw fa-question"></span><span class="title">Getting help</span></a>
                                <div id="dropdown-10" class="panel-collapse collapse" style="height: 0px;">
                                    <div class="panel-body">
                                        <ul class="nav navbar-nav">
                                            <li ><a href="/documentation-archive/v3.4.1/help/"><i class="fa fa-fw fa-users"></i> Community help</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/consulting/"><i class="fa fa-fw fa-user-md"></i> Professional help</a></li>
                                            <li ><a href="/documentation-archive/v3.4.1/training/"><i class="fa fa-fw fa-graduation-cap"></i> Training</a></li>
                                        </ul>
                                     </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <!-- /.navbar-collapse -->
                </nav>
            </div>
            <!-- Main Content -->


            <div id="page-wrapper" class="container-fluid">
                <div class="side-body" id="page-top">
                    
                    <div class="row page-content-wrapper">
                        <div class="col-lg-12">
                            <h1 id="i-classfa-fa-sitemapi-doing-microservices-with-jhipster"><i class="fa fa-sitemap"></i> Doing microservices with JHipster</h1>

<h2 id="summary">Summary</h2>

<ol>
  <li><a href="#microservices_vs_monolithic">Microservices vs Monolithic architecture</a></li>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#gateway">The JHipster API gateway</a>
    <ul>
      <li><a href="#http_routing">HTTP routing</a></li>
      <li><a href="#security">Security</a></li>
      <li><a href="#documentation">Automatic documentation</a></li>
      <li><a href="#rate_limiting">Rate limiting</a></li>
      <li><a href="#acl">Access control policy</a></li>
    </ul>
  </li>
  <li><a href="#registry">The JHipster Registry</a>
    <ul>
      <li><a href="#registry_overview">JHipster Registry overview</a></li>
      <li><a href="#securing_registry">Securing the JHipster Registry</a></li>
      <li><a href="#registry_app_configuration">Application configuration with the JHipster Registry</a></li>
    </ul>
  </li>
  <li><a href="#microservices">Creating microservices</a>
    <ul>
      <li><a href="#generating_entities">Generating entities</a></li>
      <li><a href="#hazelcast">Distributed caching with HazelCast</a></li>
      <li><a href="#no_database">Microservices with no database</a></li>
    </ul>
  </li>
  <li><a href="#docker_compose">Using Docker Compose</a></li>
  <li><a href="#monitoring">Monitoring with JHipster Console and the ELK stack</a></li>
  <li><a href="#production">Production</a>
    <ul>
      <li><a href="#docker_swarm">Going to production with Docker Swarm</a></li>
      <li><a href="#cloudfoundry">Going to production with CloudFoundry</a></li>
      <li><a href="#heroku">Going to production with Heroku</a></li>
    </ul>
  </li>
</ol>

<h2 id="a-namemicroservicesvsmonolithica-microservices-vs-monolithic-architecture"><a name="microservices_vs_monolithic"></a> Microservices vs Monolithic architecture</h2>

<p>The first question JHipster will ask you is the kind of application you want to generate. You have in fact the choice between two architecture styles:</p>

<ul>
  <li>A “monolithic” architecture uses a single, one-size-fits-all application, which contains both the front-end AngularJS code, and the back-end Spring Boot code.</li>
  <li>A “microservices” architecture splits the front-end and the back-end, so that it’s easier for your application to scale and survive infrastructure issues.</li>
</ul>

<p>A “monolithic” application is much easier to work on, so if you don’t have any specific requirements, this is the option we recommend, and our default option.</p>

<p><em>The rest of this guide is only for people interested in doing a microservices architecture.</em></p>

<h2 id="a-nameoverviewa-overview"><a name="overview"></a> Overview</h2>

<p>The JHipster microservices architecture works in the following way:</p>

<ul>
  <li>A <a href="#gateway">gateway</a> is a JHipster-generated application (using application type <code class="highlighter-rouge">microservice gateway</code> when you generate it) that handles Web traffic, and serves an AngularJS application. There can be several different gateways, if you want to follow the <a href="https://www.thoughtworks.com/insights/blog/bff-soundcloud">Backends for Frontends pattern</a>, but that’s not mandatory.</li>
  <li>The <a href="#registry">JHipster Registry</a> is a runtime application, using the usual JHipster structure, on which all applications registers and get their configuration from.</li>
  <li>Microservices are JHipster-generated applications (using application type <code class="highlighter-rouge">microservice application</code> when you generate them), that handle REST requests. They are stateless, and several instances of them can be launched in parallel to handle heavy loads.</li>
  <li>The <a href="https://github.com/jhipster/jhipster-console">JHipster Console</a> is a monitoring &amp; alerting console, based on the ELK stack.</li>
</ul>

<p>In the diagram below, the green components are specific to your application and the blue components provide its underlying infrastructure.</p>

<p><img src="/documentation-archive/v3.4.1/images/microservices_architecture_1.png" alt="Diagram" /></p>

<h2 id="a-namegatewaya-the-jhipster-api-gateway"><a name="gateway"></a> The JHipster API gateway</h2>

<p>JHipster allows use to generate an API gateway. This gateway is a normal JHipster application, so you can use the usual JHipster options and development workflows on that project, but it also acts as the entrance to your microservices. More specifically, it provides HTTP routing and load balancing, quality of service, security and API documentation for all microservices.</p>

<h3 id="a-namehttproutinga-http-requests-routing-using-the-gateway"><a name="http_routing"></a> HTTP requests routing using the gateway</h3>

<p>When the gateways and the microservices are launched, they will register themselves in the registry (using the <code class="highlighter-rouge">eureka.client.serviceUrl.defaultZone</code> key in the <code class="highlighter-rouge">src/main/resources/config/application.yml</code> file).</p>

<p>The gateway will automatically proxy all requests to the microservices, using their application name: for example, when microservices <code class="highlighter-rouge">app1</code> is registered, it is available on the gateway on the <code class="highlighter-rouge">/app1</code> URL.</p>

<p>For example, if your gateway is running on <code class="highlighter-rouge">localhost:8080</code>, you could point to <a href="http://localhost:8080/app1/rest/foos">http://localhost:8080/app1/rest/foos</a> to
get the <code class="highlighter-rouge">foos</code> resource served by microservice <code class="highlighter-rouge">app1</code>. If you’re trying to do this with your Web browser, don’t forget REST resources are secured by default in JHipster, so you need to send the correct JWT header (see the point on security below), or remove the security on those URLs in the microservice’s <code class="highlighter-rouge">MicroserviceSecurityConfiguration</code> class.</p>

<p>If there are several instances of the same service running, the gateway will get those instances from the JHipster Registry, and will:</p>

<ul>
  <li>Load balance HTTP requests using <a href="https://github.com/Netflix/ribbon">Netflix Ribbon</a>.</li>
  <li>Provide a circuit breaker using <a href="https://github.com/Netflix/hystrix">Netflix Hystrix</a>, so that failed instances are quickly and safely removed.</li>
</ul>

<p>Each gateway as a specific “admin &gt; gateway” menu, where opened HTTP routes and microservices instances can be monitored.</p>

<h3 id="a-namesecuritya-security"><a name="security"></a> Security</h3>

<h4 id="jwt-json-web-token">JWT (JSON Web Token)</h4>

<p>JWT (JSON Web Token) is an industry standard, easy-to-use method for securing applications in a microservices architecture.</p>

<p>JHispter uses the <a href="https://github.com/jwtk/jjwt">JJWT library</a>, provided by Stormpath, for implementing JWT.</p>

<p>Tokens are generated by the gateway, and sent to the underlying microservices: as they share a common secret key, microservices are able to validate the token, and authenticate users using that token.</p>

<p>Those tokens are self-sufficient: they have both authentication and authorization information, so microservices do not need to query a database or an external system. This is important in order to ensure a scalable architecture.</p>

<p>For security to work, a JWT secret token must be shared between all applications.</p>

<ul>
  <li>For each application the default token is unique, and generated by JHipster. It is stored in the <code class="highlighter-rouge">.yo-rc.json</code> file.</li>
  <li>Tokens are configured with the <code class="highlighter-rouge">jhipster.security.authentication.jwt.secret</code> key in the <code class="highlighter-rouge">src/main/resources/config/application.yml</code> file.</li>
  <li>To share this key between all your applications, copy the key from your gateway to all the microservices, or share it using the JHipster Registry’s Spring Config Server.</li>
  <li>A good practice is to have a different key in development and production.</li>
</ul>

<h4 id="oauth2">OAuth2</h4>

<p>This feature is currently in <strong>BETA</strong> and thus its documentation is not yet complete.</p>

<p>JHipster provides the option to generate a “UAA” (User Account and Authentication) server, based on Spring Security. This server provides OAuth2 tokens for securing the gateway.</p>

<p>Then, the gateway uses Spring Security’s JWT implementation to send JWT tokens to the microservices.</p>

<h3 id="a-namedocumentationa-automatic-documentation"><a name="documentation"></a> Automatic documentation</h3>

<p>The gateway exposes the Swagger API definitions of the services it proxifies so you can benefit from all useful tools like Swagger UI and swagger-codegen.</p>

<p>The “admin &gt; API” menu of a gateway has a specific drop-down list, showing the gateway’s API and all the APIs from the registered microservices.</p>

<p>Using this drop-down list, all microservices APIs are automatically documented, and testable from the gateway.</p>

<p>When using a secured API, security tokens are automatically added to the Swagger UI interface, so all requests work out-of-the-box.</p>

<h3 id="a-nameratelimitinga-rate-limiting"><a name="rate_limiting"></a> Rate limiting</h3>

<p>This is an advanced feature that requires setting up a Cassandra cluster (which is easy to do with the provided Docker Compose configuration).</p>

<p>Gateways provide rate-limiting features, so the number of REST requests can be limited:</p>

<ul>
  <li>by IP address (for anonymous users)</li>
  <li>by user login (for logged-in users)</li>
</ul>

<p>JHipster will then use a Cassandra cluster to store request counts, and will send HTTP 429 (too many requests) errors when the limit is exceeded. The default limit per user is 100,000 API calls per hour.</p>

<p>This is an important feature, to protect a microservice architecture from being flooded by a specific user’s requests.</p>

<p>As the gateway secures the REST endpoints, it has full access to the user’s security information, so it can be easily extended to provide specific rate limits depending on the user’s security roles.</p>

<p>To enable rate limiting, open up the <code class="highlighter-rouge">application-dev.yml</code> or <code class="highlighter-rouge">application-prod.yml</code> file and set <code class="highlighter-rouge">enabled</code> to <code class="highlighter-rouge">true</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>jhipster:
    gateway:
        rate-limiting:
            enabled: true
</code></pre>
</div>

<p>The Cassandra cluster needs to be set up and configured. If you use JHipster’s Docker Compose configuration (available in <code class="highlighter-rouge">src/main/docker</code>), this should all work automatically, but here are the detailed steps if you want to set up your cluster manually:</p>

<ul>
  <li>A working Cassandra cluster should be available.</li>
  <li>A schema with the JHipster rate-limiting tables must be configured, using the <code class="highlighter-rouge">create_keyspace.cql</code> and <code class="highlighter-rouge">create_tables.cql</code> scripts from the <code class="highlighter-rouge">src/main/resources/config/cql</code> directory</li>
  <li>That cluster must configured in the <code class="highlighter-rouge">application-*.yml</code> files, using the <code class="highlighter-rouge">spring.data.cassandra</code> keys (a default configuration is already generated)</li>
</ul>

<p>If you want to add more rules, or modify the existing rules, you need to code them in the <code class="highlighter-rouge">RateLimitingFilter</code> class. Examples of modifications could be:</p>

<ul>
  <li>Lowering the limit of HTTP calls</li>
  <li>Adding limits per minute or per day</li>
  <li>Removing all limits for “admin” users</li>
</ul>

<h3 id="a-nameacla-access-control-policy"><a name="acl"></a> Access control policy</h3>

<p>By default all registered microservices are available through the gateway. If you want to exclude a specific API from being exposed through the gateway, you can use the gateway’s specific access control policy filter. It is configurable using the <code class="highlighter-rouge">jhipster.gateway.authorized-microservices-endpoints</code> key in the <code class="highlighter-rouge">application-*.yml</code> files:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>jhipster:
    gateway:
        authorized-microservices-endpoints: # Access Control Policy, if left empty for a route, all endpoints will be accessible
            app1: /api,/v2/api-docs # recommended dev configuration
</code></pre>
</div>

<p>For example, if you only want the <code class="highlighter-rouge">/api/foo</code> endpoint of microservice <code class="highlighter-rouge">bar</code> to be available:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>jhipster:
    gateway:
        authorized-microservices-endpoints:
            bar: /api/foo
</code></pre>
</div>

<h2 id="a-nameregistrya-the-jhipster-registry"><a name="registry"></a> The JHipster Registry</h2>

<h3 id="a-nameregistryoverviewa-jhipster-registry-overview"><a name="registry_overview"></a> JHipster Registry overview</h3>

<p>The JHipster Registry is a runtime application, provided by the JHipster team. Like the JHipster generator, it is an Open Source, Apache 2-licensed application, and its source code is available on GitHub under the JHipster organization at <a href="https://github.com/jhipster/jhipster-registry">jhipster/jhipster-registry</a>.</p>

<p>The JHipster Registry can be cloned/forked/downloaded directly from <a href="https://github.com/jhipster/jhipster-registry">jhipster/jhipster-registry</a>, and we recommend you use the same version tag as the one you use for your JHipster generator. As the JHipster Registry is also a JHipster-generated application, you can run it like any other JHipster application:</p>

<ul>
  <li>run it with <code class="highlighter-rouge">./mvnw</code> in development, it will use by default the <code class="highlighter-rouge">dev</code> profile and the Eureka Registry will be available at <a href="http://127.0.0.1:8761/">http://127.0.0.1:8761/</a>.</li>
  <li>use <code class="highlighter-rouge">./mvnw -Pprod package</code> to package it in production, and generate the usual JHipster executable WAR file.</li>
</ul>

<p>If you’d rather run the JHipster Registry from a Docker image, it is available an Docker Hub at <a href="https://hub.docker.com/r/jhipster/jhipster-registry/">jhipster/jhipster-registry</a>. This image is already pre-configured in the Docker configuration that is provided with each microservice application:</p>

<ul>
  <li>run <code class="highlighter-rouge">docker-compose -f src/main/docker/jhipster-registry.yml up</code> to start the JHipster Registry. The Eureka Registry will be available on port <code class="highlighter-rouge">8761</code> of your Docker host, so if it runs on your machine it should be at <a href="http://127.0.0.1:8761/">http://127.0.0.1:8761/</a>.</li>
</ul>

<p>Please read our <a href="/documentation-archive/v3.4.1/docker-compose/">Docker Compose documentation</a> for more information on using the JHipster Registry with Docker Compose.</p>

<h3 id="a-namesecuringregistrya-securing-the-jhipster-registry"><a name="securing_registry"></a> Securing the JHipster Registry</h3>

<p>The JHipster Registry is secured by default. You can login using the usual “admin/admin” login and password that are used in normal JHipster applications.</p>

<p>Applications also connect to the JHipster Registry using that same “admin” user, but use HTTP Basic authentication. So if your microservices cannot access the registry, and you see some “401 authentication error” messages, it is because you have misconfigured those applications.</p>

<p>In order to secure your JHipster Registry:</p>

<ul>
  <li>You must change the default “admin” password. This password is set using the standard Spring Boot property <code class="highlighter-rouge">security.user.password</code>, so you can use the usual Spring Boot mechanisms to modify it: you could modify the project’s <code class="highlighter-rouge">application-*.yml</code> files, or add a <code class="highlighter-rouge">SECURITY_USER_PASSWORD</code> environment variable. The <a href="/documentation-archive/v3.4.1/docker-compose/">Docker Compose sub-generator</a> uses the environment variable method.</li>
  <li>As your applications will connect to the registry using HTTP, it is very important to secure that connection channel. There are many ways to do it, and the easiest one is probably to use HTTPS.</li>
</ul>

<h3 id="a-nameregistryappconfigurationa-application-configuration-with-the-jhipster-registry"><a name="registry_app_configuration"></a> Application configuration with the JHipster Registry</h3>

<p>The JHipster Registry is a <a href="https://github.com/Netflix/eureka">Netflix Eureka server</a> and also a <a href="http://cloud.spring.io/spring-cloud-config/spring-cloud-config.html">Spring Config Server</a>: when applications are launched they will first connect to the JHipster Registry to get their configuration. This is true for both gateways and microservices.</p>

<p>This configuration is a Spring Boot configuration, like the one found in the JHipster <code class="highlighter-rouge">application-*.yml</code> files, but it is stored in a central server, so it is easier to manage.</p>

<p>On startup, your gateways and microservices app will query the Registry’s config server and overwrite their local properties with the ones defined there.</p>

<p>Two kinds of configurations sources are available:</p>

<ul>
  <li>A <code class="highlighter-rouge">native</code> configuration, which is used by default in development (using the JHipster <code class="highlighter-rouge">dev</code> profile), and which uses the local filesystem.</li>
  <li>A <code class="highlighter-rouge">Git</code> configuration, which is used by default in production (using the JHipster <code class="highlighter-rouge">prod</code> profile), and which stores the configuration in a Git server. This allows to tag, branch or rollback configurations using the usual Git tools, which are very powerful in this use-case.</li>
</ul>

<p>To manage your centralized configuration you just need to add <code class="highlighter-rouge">appname-profile.yml</code> files in your configuration source where <strong>appname</strong> and <strong>profile</strong> correspond to the application’s name and current profile of the service that you want to configure.
For example, adding properties in a <code class="highlighter-rouge">gateway-prod.yml</code> file will set those properties only for the application named <strong>gateway</strong> started with a <strong>prod</strong> profile. Moreover, properties defined in <code class="highlighter-rouge">application[-dev|prod].yml</code> will be set for all your applications.</p>

<p>As the Gateway routes are configured using Spring Boot, they can also be managed using the Spring Config Server, for example you could map application <code class="highlighter-rouge">app1-v1</code> to the <code class="highlighter-rouge">/app1</code> URL in your <code class="highlighter-rouge">v1</code> branch, and map application <code class="highlighter-rouge">app1-v2</code> to the <code class="highlighter-rouge">/app1</code> URL in your <code class="highlighter-rouge">v2</code> branch. This is a good way of upgrading microservices without any downtime for end-users.</p>

<h2 id="a-namemicroservicesa-creating-microservices"><a name="microservices"></a> Creating microservices</h2>

<p>Microservices are a type of JHipster applications, that have no front-end (the AngularJS front-end must be generated on a gateway), and which work with the JHipster Registry to be configured and discovered.</p>

<h3 id="a-namegeneratingentitiesa-generating-entities-in-a-microservices-architecture"><a name="generating_entities"></a> Generating entities in a microservices architecture</h3>

<p>Using the <a href="/documentation-archive/v3.4.1/creating-an-entity/">entity sub-generator</a> works a little bit differently in a microservices architecture, as the front-end and the back-end codes are not located in the same application.</p>

<p>First, generate the entities in the microservices applications: this works as usual, and you can also use <a href="/documentation-archive/v3.4.1/jhipster-uml/">JHipster UML</a> or <a href="/documentation-archive/v3.4.1/jdl-studio/">JDL Studio</a> to help you generate complex entities and relationships. As microservices don’t have a front-end, no AngularJS code will be generated.</p>

<p>Then, on the gateway(s), run the entity sub-generator again. A new question will appear at the beginning, which is specific to gateways:</p>

<ul>
  <li>You will have the choice either to generate an new entity normally (a gateway is also a standard JHipster application, so this would work like for a monolith application), or use an existing JHipster configuration from a microservice.</li>
  <li>If you choose to generate the entity from a microservice, you will need to enter the path to this microservice on your local computer, and then JHipster will generate the front-end code on the gateway.</li>
</ul>

<h3 id="a-namehazelcasta-distributed-caching-with-hazelcast"><a name="hazelcast"></a> Distributed caching with Hazelcast</h3>

<p>If your application uses an SQL database, JHipster proposes a different 2nd-level caching solution with microservices:</p>

<ul>
  <li>JHipster’s default caching solution with microservices is Hazelcast</li>
  <li>You can still choose Ehcache (the default solution with monolith applications) or choose not to use a cache at all</li>
</ul>

<p>This solution is the default with microservices, as in this architecture the idea is that you will scale your services:</p>

<ul>
  <li>with a local cache, your service instances won’t have a synchronized cache, resulting in incorrect data</li>
  <li>without any cache, the burden of scaling will be pushed to the database, which won’t be very good at it (unless you use our Cassandra option)</li>
</ul>

<p>Using Hazelcast with microservices will result in a specific configuration:</p>

<ul>
  <li>At start-up, your application will connect to the JHipster Registry to find if other instances of the same service are running</li>
  <li>With the <code class="highlighter-rouge">dev</code> profile, JHipster will create a cluster of those instances on localhost (<code class="highlighter-rouge">127.0.0.1</code>),  using a different port per instance. By default, the Hazelcast port is <code class="highlighter-rouge">your application's port + 5701</code> (so if your application’s port is <code class="highlighter-rouge">8081</code>, Hazelcast will use port <code class="highlighter-rouge">13782</code>)</li>
  <li>With the <code class="highlighter-rouge">prod</code> profile, JHipster will create a cluster with all the other nodes it finds, using the default Hazelcast port (<code class="highlighter-rouge">5701</code>)</li>
</ul>

<h3 id="a-namenodatabasea-microservices-with-no-database"><a name="no_database"></a> Microservices with no database</h3>

<p>Only microservices applications can be created without a database. This is because microservices are small and do not have user-management code.</p>

<p>A microservice without a database is very small, and could be used to connect to a specific back-end like a legacy system.</p>

<h2 id="a-namedockercomposea-using-docker-compose-to-develop-and-deploy"><a name="docker_compose"></a> Using Docker Compose to develop and deploy</h2>

<p>Working on a microservices architecture means you will need several different services and databases working together, and in that context Docker Compose is a great tool to manage your development, testing and production environments.</p>

<p>A specific section on microservices is included in our <a href="/documentation-archive/v3.4.1/docker-compose#microservices">Docker Compose documentation</a>, and we highly recommend that you get familiar with it when working on a microservices architecture.</p>

<h2 id="a-namemonitoringa-monitoring-with-jhipster-console-and-the-elk-stack"><a name="monitoring"></a> Monitoring with JHipster Console and the ELK stack</h2>

<p>When using the Docker-Compose sub-generator, you will be asked if you want to add monitoring to your infrastructure. This option, will add the JHipster-Console to your <code class="highlighter-rouge">docker-compose.yml</code> file. Once started, it will be available on <a href="http://localhost:5601">http://localhost:5601</a> and start to gather your applications’ logs and metrics. For instructions on how to set up monitoring for your applications please refer to the <a href="/documentation-archive/v3.4.1/monitoring">monitoring documentation</a>.</p>

<p>Compared with monolithic applications, gateways and microservices monitoring configuration provide additional features to help you effectively monitor a microservices cluster. For example logs are enriched with each application’s name, host, port and Eureka ServiceId so that you can trace from which service they are originating from. Moreover the JHipster Console comes with default dashboards that give you a view of all your services at the same time.</p>

<h2 id="a-nameproductiona-production"><a name="production"></a> Production</h2>

<h3 id="a-namedockerswarma-going-to-production-with-docker-swarm"><a name="docker_swarm"></a> Going to production with Docker Swarm</h3>

<p>As Docker Swarm uses the same API as Docker Machine, deploying your microservices architecture in the cloud is exactly the same as deploying it on your local machine. Follow our <a href="/documentation-archive/v3.4.1/docker-compose/">Docker Compose documentation</a> to learn more about using Docker Compose with JHipster.</p>

<h3 id="a-namecloudfoundrya-going-to-production-with-cloudfoundry"><a name="cloudfoundry"></a> Going to production with CloudFoundry</h3>

<p>The <a href="/documentation-archive/v3.4.1/cloudfoundry/">CloudFoundry sub-generator</a> works the same with a microservices architecture, the main difference is that you have more applications to deploy:</p>

<ul>
  <li>Use the sub-generator to deploy first the JHipster Registry (which is a normal JHipster application).</li>
  <li>Note the URL on which your JHipster Registry is deployed. Your applications must all point to that URL:
    <ul>
      <li>In the <code class="highlighter-rouge">bootstrap-prod.yml</code> file, the <code class="highlighter-rouge">spring.cloud.config.uri</code> must point to <code class="highlighter-rouge">http://&lt;your_jhipster_registry_url&gt;/config/</code></li>
      <li>In the <code class="highlighter-rouge">application-prod.yml</code> file, the <code class="highlighter-rouge">eureka.client.serviceUrl.defaultZone</code> must point to <code class="highlighter-rouge">http://&lt;your_jhipster_registry_url&gt;/eureka/</code></li>
    </ul>
  </li>
  <li>Deploy your gateway(s) and microservices</li>
  <li>Scale your applications as usual with Cloud Foundry</li>
</ul>

<p>One important point to remember is that the JHipster Registry isn’t secured by default, and that the microservices are not supposed to be accessible from the outside world, as users are supposed to use the gateway(s) to access your application.</p>

<p>Two solutions are available to solve this issue:</p>

<ul>
  <li>Secure your Cloud Foundry using specific routes.</li>
  <li>Keep everything public, but use HTTPS everywhere, and secure your JHipster Registry using Spring Security’s basic authentication support</li>
</ul>

<h3 id="a-nameherokua-going-to-production-with-heroku"><a name="heroku"></a> Going to production with Heroku</h3>

<p>The <a href="/documentation-archive/v3.4.1/heroku/">Heroku sub-generator</a> works nearly the same with a microservices architecture, the main difference is that you have more applications to deploy:</p>

<p>Deploy a JHipster Registry directly with one click:</p>

<p><a href="https://dashboard-preview.heroku.com/new?&amp;template=https%3A%2F%2Fgithub.com%2Fjhipster%2Fjhipster-registry"><img src="https://camo.githubusercontent.com/c0824806f5221ebb7d25e559568582dd39dd1170/68747470733a2f2f7777772e6865726f6b7563646e2e636f6d2f6465706c6f792f627574746f6e2e706e67" alt="Deploy to Heroku" /></a></p>

<p>Please follow the <a href="/documentation-archive/v3.4.1/heroku/">Heroku sub-generator documentation</a> in order to understand how to secure your JHipster Registry.</p>

<p>Note the URL on which your JHipster Registry is deployed. Your applications must all point to that URL in their <code class="highlighter-rouge">application-prod.yml</code> file. Change that configuration to be:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>eureka:
    instance:
        hostname: &lt;your_jhipster_registry_url&gt;.herokuapp.com
        non-secure-port: 80
        prefer-ip-address: false
</code></pre>
</div>

<p>You can now deploy and scale the gateway(s) and microservices. The Heroku sub-generator will ask you a new question, to know the URL of your JHipster Registry: this will allow your applications to fetch their configuration on the Spring Cloud Config server.</p>

<p><strong>Warning</strong> The above configuration uses HTTP, but in order to have your architecture secured in production, use HTTPS to connect to the JHipster Registry! As the admin password is sent using HTTP Basic authentication, using an encrypted communication channel is very highly recommended.</p>

                        </div>
                    </div>
                    <!-- /.row -->
                    

                    <!-- Footer -->
                    <footer class="text-center">
                        <div class="footer-above">
                            <div class="container">
                                <div class="row">
                                    <div class="footer-col col-md-4">
                                        <div class="col-md-6 col-sm-12">
                                            <h5 class="text-left"><i class="fa fa-coffee fa-fw"></i> <a class="link" href="/documentation-archive/v3.4.1/team/">Team</a></h5>
                                            <h5 class="text-left"><i class="fa fa-pencil fa-fw"></i> <a class="link" href="/documentation-archive/v3.4.1/artwork">Artwork</a></h5>
                                        </div>
                                        <div class="col-md-6 col-sm-12">
                                            <h5 class="text-left"><i class="fa fa-gavel fa-fw"></i> <a class="link" href="/documentation-archive/v3.4.1/policies/">Policies</a></h5>
                                            <h5 class="text-left"><i class="fa fa-gift fa-fw"></i> <a class="link" href="/documentation-archive/v3.4.1/thanks/">Thanks</a></h5>
                                        </div>
                                    </div>
                                    <div class="footer-col col-md-4">
                                        <ul class="list-inline">
                                            <li>
                                                <a href="https://twitter.com/java_hipster" target="_blank" class="btn-social btn-outline"><i class="fa fa-fw fa-twitter"></i></a>
                                            </li>
                                            <li>
                                                <a href="https://github.com/jhipster/generator-jhipster" target="_blank" class="btn-social btn-outline"><i class="fa fa-fw fa-github"></i></a>
                                            </li>
                                            <li>
                                                <a href="https://gitter.im/jhipster/generator-jhipster" target="_blank" class="btn-social btn-outline"><i class="fa fa-fw fa-comments"></i></a>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="footer-col col-md-4 google-search">
                                        <script>
                                            (function () {
                                                var cx = '004687894124070278856:-ryvp1pk0xi';
                                                var gcse = document.createElement('script');
                                                gcse.type = 'text/javascript';
                                                gcse.async = true;
                                                gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
                                                    '//cse.google.com/cse.js?cx=' + cx;
                                                var s = document.getElementsByTagName('script')[0];
                                                s.parentNode.insertBefore(gcse, s);
                                            })();
                                        </script>
                                        <gcse:search></gcse:search>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="footer-below">
                            <div class="container">
                                <div class="row">
                                    <div class="col-lg-12">
                                        Copyright &copy; JHipster 2016 | Theme based on <a href="https://github.com/IronSummitMedia/startbootstrap-freelancer" target="_blank">Freelancer</a> and <a href="https://github.com/tui2tone/flat-admin-bootstrap-templates" target="_blank">Flat admin</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </footer>
                </div>
                <!-- Scroll to Top Button (Only visible on small and extra-small screen sizes) -->
                <div class="scroll-top page-scroll visible-xs visible-sm">
                    <a class="btn btn-primary" href="#page-top">
                        <i class="fa fa-chevron-up"></i>
                    </a>
                </div>
            </div>
            <!-- /#page-wrapper -->
        </div>
        <!-- /#wrapper -->
    </div>
    <!-- Javascript Libs -->
    <script type="text/javascript" src="/documentation-archive/v3.4.1/lib/js/jquery.min.js"></script>
    <script type="text/javascript" src="/documentation-archive/v3.4.1/lib/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/documentation-archive/v3.4.1/lib/js/ace.js"></script>
    <script type="text/javascript" src="/documentation-archive/v3.4.1/lib/js/mode-html.js"></script>
    <script type="text/javascript" src="/documentation-archive/v3.4.1/lib/js/theme-github.js"></script>
    <script type="text/javascript" src="/documentation-archive/v3.4.1/lib/js/jquery.easing.min.js"></script>

    

    <!--App Javascript -->
    <script type="text/javascript" src="/documentation-archive/v3.4.1/js/app.js"></script>
    
    
    <!-- JavaScript -->
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-46075199-1', 'jhipster.github.io');
        ga('send', 'pageview');
    </script>
</body>

</html>
